<!DOCTYPE html>
<html lang="zh-hans">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Java 搭建简单的 RESTful API 服务器</title>
<link rel="stylesheet" href="../static/css/markdown.css">
</head>
<body>
<article class="markdown-body">
<h1 id="java-搭建简单的-restful-api-服务器">Java 搭建简单的 RESTful API 服务器</h1>
<p>📌 面向对象的程序设计课程作业，选择 Jersey 框架进行开发</p>
<p>✅ 搭建开发环境</p>
<p>✅ 实现 POST GET PUT DELETE 四种 HTTP 方法</p>
<p>✅ 测试</p>
<h2 id="1-配置开发环境">1. 配置开发环境</h2>
<p>本地环境使用 Windows 下 Intellij IDEA 进行开发。</p>
<ol>
<li><p>下载 JDK 和 Maven 并配置环境变量。</p>
</li>
<li><p>新建一个 Maven 项目，选择 <code>org.apache.maven.archetypes:maven-archetype-webapp</code>，并把 <code>Maven home directory</code> <code>User settings file</code> <code>Local repository</code> 改为下载好的文件位置，如果没有 repository 文件夹就新建一个。</p>
</li>
<li><p>等 IDEA 自动配置完后在 pom.xml 中添加以下内容：</p>
<pre><code class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.glassfish.jersey.containers<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jersey-container-servlet<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.29.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.glassfish.jersey.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jersey-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.29.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.glassfish.jersey.media<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jersey-media-json-jackson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.29.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.glassfish.jersey.inject<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jersey-hk2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.29.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre>
</li>
<li><p>在 <code>/src/main/webapp/WEB-INF/web.xml</code> 中添加以下代码：</p>
<pre><code class="language-xml"><span class="hljs-params">&lt;servlet&gt;</span>
    <span class="hljs-params">&lt;servlet-name&gt;</span>server<span class="hljs-params">&lt;/servlet-name&gt;</span>
    <span class="hljs-params">&lt;servlet-class&gt;</span>org.glassfish.jersey.servlet.ServletContainer<span class="hljs-params">&lt;/servlet-class&gt;</span>
    <span class="hljs-params">&lt;init-param&gt;</span>
        <span class="hljs-params">&lt;param-name&gt;</span>jersey.config.server.provider.packages<span class="hljs-params">&lt;/param-name&gt;</span>
        <span class="hljs-params">&lt;param-value&gt;</span>lfn.java<span class="hljs-params">&lt;/param-value&gt;</span>
    <span class="hljs-params">&lt;/init-param&gt;</span>
<span class="hljs-params">&lt;/servlet&gt;</span>
<span class="hljs-params">&lt;servlet-mapping&gt;</span>
    <span class="hljs-params">&lt;servlet-name&gt;</span>server<span class="hljs-params">&lt;/servlet-name&gt;</span>
    <span class="hljs-params">&lt;url-pattern&gt;</span><span class="hljs-meta-keyword">/api/</span>*<span class="hljs-params">&lt;/url-pattern&gt;</span>
<span class="hljs-params">&lt;/servlet-mapping&gt;</span></code></pre>
</li>
<li><p>添加文件夹：</p>
<ul>
<li><code>/src/main/java/</code> 存放 java 代码</li>
<li><code>/src/main/resource/</code> 存放资源文件</li>
<li><code>/src/test/java/</code></li>
<li><code>/src/test/resource/</code> </li>
</ul>
</li>
<li><p>在 <code>/src/main/java/</code> 文件夹下新建 Package，添加三个 Class：<code>MainService</code> <code>EventHandler</code> <code>DataModel</code>。</p>
</li>
<li><p>目录结构如下（使用 <code>tree /f</code> 命令）：</p>
<pre><code>│  pom.xml
│
└─src
    ├─main
    │  ├─<span class="hljs-keyword">java
</span>    │  │  └─lfn
    │  │      └─<span class="hljs-keyword">java
</span>    │  │              DataModel.<span class="hljs-keyword">java
</span>    │  │              EventHandler.<span class="hljs-keyword">java
</span>    │  │              MainService.<span class="hljs-keyword">java
</span>    │  │
    │  ├─resources
    │  └─webapp
    │      │  index.<span class="hljs-keyword">jsp
</span>    │      │
    │      └─WEB-INF
    │              web.xml
    │
    └─test
        ├─<span class="hljs-keyword">java
</span>        └─resources
</code></pre></li>
</ol>
<h2 id="2-代码实现">2. 代码实现</h2>
<h3 id="mainservice"><code>MainService</code></h3>
<p>用于处理四种 HTTP 方法。</p>
<pre><code class="language-java"><span class="hljs-keyword">package</span> lfn.java;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;

<span class="hljs-keyword">import</span> javax.ws.rs.*;
<span class="hljs-keyword">import</span> javax.ws.rs.core.MediaType;
<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-meta">@Path(<span class="hljs-meta-string">"/"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainService</span> </span>{
    <span class="hljs-meta">@GET</span>
    <span class="hljs-meta">@Path(<span class="hljs-meta-string">"/get"</span>)</span>
    <span class="hljs-meta">@Produces(MediaType.APPLICATION_JSON)</span>
    <span class="hljs-keyword">public</span> String getMethod() {
        <span class="hljs-keyword">return</span> EventHandler.find();
    }

    <span class="hljs-meta">@GET</span>
    <span class="hljs-meta">@Path(<span class="hljs-meta-string">"/get/{id}"</span>)</span>
    <span class="hljs-meta">@Produces(MediaType.APPLICATION_JSON)</span>
    <span class="hljs-keyword">public</span> String getMethod(<span class="hljs-meta">@PathParam(<span class="hljs-meta-string">"id"</span>)</span> String id) {
        <span class="hljs-keyword">return</span> EventHandler.find(id);
    }

    <span class="hljs-meta">@POST</span>
    <span class="hljs-meta">@Path(<span class="hljs-meta-string">"/post"</span>)</span>
    <span class="hljs-meta">@Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})</span>
    <span class="hljs-meta">@Produces(MediaType.APPLICATION_JSON)</span>
    <span class="hljs-keyword">public</span> String postMethod(String body) {
        ObjectMapper mapper = new ObjectMapper();
        <span class="hljs-keyword">try</span> {
            DataModel <span class="hljs-keyword">data</span> = mapper.readValue(body, DataModel<span class="hljs-class">.<span class="hljs-keyword">class</span>);</span>
            <span class="hljs-keyword">return</span> EventHandler.add(<span class="hljs-keyword">data</span>);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"ERROR\"}"</span>;
        }
    }

    <span class="hljs-meta">@PUT</span>
    <span class="hljs-meta">@Path(<span class="hljs-meta-string">"/put/{id}"</span>)</span>
    <span class="hljs-meta">@Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})</span>
    <span class="hljs-meta">@Produces(MediaType.APPLICATION_JSON)</span>
    <span class="hljs-keyword">public</span> String putMethod(String body, <span class="hljs-meta">@PathParam(<span class="hljs-meta-string">"id"</span>)</span> String id) {
        ObjectMapper mapper = new ObjectMapper();
        <span class="hljs-keyword">try</span> {
            DataModel <span class="hljs-keyword">data</span> = mapper.readValue(body, DataModel<span class="hljs-class">.<span class="hljs-keyword">class</span>);</span>
            <span class="hljs-keyword">return</span> EventHandler.update(<span class="hljs-keyword">data</span>, id);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"ERROR\"}"</span>;
        }
    }

    <span class="hljs-meta">@DELETE</span>
    <span class="hljs-meta">@Path(<span class="hljs-meta-string">"/delete/{id}"</span>)</span>
    <span class="hljs-meta">@Produces(MediaType.APPLICATION_JSON)</span>
    <span class="hljs-keyword">public</span> String deleteMethod(<span class="hljs-meta">@PathParam(<span class="hljs-meta-string">"id"</span>)</span> String id) {
        <span class="hljs-keyword">return</span> EventHandler.remove(id);
    }
}
</code></pre>
<h3 id="eventhandler"><code>EventHandler</code></h3>
<p>用于对接收数据进行处理并返回。</p>
<pre><code class="language-java">package lfn.java;

<span class="hljs-keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventHandler</span> {</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;DataModel&gt; <span class="hljs-built_in">list</span> = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">String</span> <span class="hljs-title">add</span><span class="hljs-params">(DataModel data)</span> </span>{
        ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
        data.setId();
        data.setDate();
        <span class="hljs-built_in">list</span>.add(data);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> mapper.writeValueAsString(data);
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"ERROR\"}"</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">String</span> <span class="hljs-title">find</span><span class="hljs-params">()</span> </span>{
        ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> mapper.writeValueAsString(<span class="hljs-built_in">list</span>);
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"ERROR\"}"</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">String</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-keyword">String</span> id)</span> </span>{
        ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (DataModel data : <span class="hljs-built_in">list</span>) {
                <span class="hljs-keyword">if</span> (data.getId().equals(id)) {
                    <span class="hljs-keyword">return</span> mapper.writeValueAsString(data);
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"NOT FOUND\"}"</span>;
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"ERROR\"}"</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">String</span> <span class="hljs-title">update</span><span class="hljs-params">(DataModel data, <span class="hljs-keyword">String</span> id)</span> </span>{
        ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (DataModel d : <span class="hljs-built_in">list</span>) {
                <span class="hljs-keyword">if</span> (d.getId().equals(id)) {
                    d.setDate();
                    d.setUser(data.getUser());
                    d.setMessage(data.getMessage());
                    <span class="hljs-keyword">return</span> mapper.writeValueAsString(d);
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"NOT FOUND\"}"</span>;
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"ERROR\"}"</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">String</span> <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">String</span> id)</span> </span>{
        ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">for</span> (DataModel data : <span class="hljs-built_in">list</span>) {
                <span class="hljs-keyword">if</span> (data.getId().equals(id)) {
                    <span class="hljs-built_in">list</span>.<span class="hljs-built_in">remove</span>(data);
                    <span class="hljs-keyword">return</span> mapper.writeValueAsString(data);
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"NOT FOUND\"}"</span>;
        } <span class="hljs-keyword">catch</span> (JsonProcessingException e) {
            e.printStackTrace();
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"status\":\"ERROR\"}"</span>;
        }
    }
}
</code></pre>
<h3 id="datamodel"><code>DataModel</code></h3>
<p>建立数据模型，<code>user</code> 和 <code>message</code> 为传入字段，<code>id</code> 随机生成，<code>date</code> 在传入后设定。</p>
<pre><code class="language-java">package lfn.java;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataModel</span> {</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> id;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> date;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> user;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">String</span> message;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DataModel</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// NO ACTION</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DataModel</span><span class="hljs-params">(<span class="hljs-keyword">String</span> user, <span class="hljs-keyword">String</span> message)</span> </span>{
        <span class="hljs-keyword">this</span>.user = user;
        <span class="hljs-keyword">this</span>.message = message;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">String</span> id = <span class="hljs-keyword">String</span>.valueOf((<span class="hljs-keyword">int</span>) (Math.<span class="hljs-built_in">random</span>() * <span class="hljs-number">10000</span>));
        <span class="hljs-keyword">this</span>.id = id;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDate</span><span class="hljs-params">()</span> </span>{
        Date date = <span class="hljs-keyword">new</span> Date();
        <span class="hljs-keyword">String</span> d = date.toString();
        <span class="hljs-keyword">this</span>.date = d;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> <span class="hljs-title">getUser</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> user;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUser</span><span class="hljs-params">(<span class="hljs-keyword">String</span> user)</span> </span>{
        <span class="hljs-keyword">this</span>.user = user;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> <span class="hljs-title">getMessage</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> message;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMessage</span><span class="hljs-params">(<span class="hljs-keyword">String</span> message)</span> </span>{
        <span class="hljs-keyword">this</span>.message = message;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">String</span> <span class="hljs-title">getDate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> date;
    }
}
</code></pre>
<h2 id="3-测试">3. 测试</h2>
<h3 id="使用-tomcat-建立服务器">使用 Tomcat 建立服务器</h3>
<ol>
<li>下载并配置环境变量。</li>
<li>在 IDEA 右上角 Add Configuration... 中，点左上角加号，向下找到 Tomcat Server --&gt; local，更改相应数据后 Apply。</li>
<li>绿色三角运行，浏览器输入之前 URL 的值，查看是否出现 index.jsp 中对应网页（默认出现 hello, world）。</li>
</ol>
<p>Tomcat 会根据打包成 war 文件的文件名来确定地址，我这里的打包文件为 server.war，网址是 <a href="http://localhost:8080/server/api/get">http://localhost:8080/server/api/get</a> 。</p>
<h3 id="使用工具进行测试">使用工具进行测试</h3>
<p>可以使用浏览器或者 Postman 之类的软件进行测试。</p>
<h3 id="用-java-写一个测试工具">用 Java 写一个测试工具</h3>
<h4 id="1-配置开发环境-1">1. 配置开发环境</h4>
<p>同样使用 Intellij IDEA 进行开发。</p>
<ol>
<li>新建项目 Gradle --&gt; Java，等待 IDEA 自动配置。</li>
<li>新建项目文件夹，目录结构与上一个相同。</li>
<li>右键添加的 java 目录，New --&gt; Swing UI Designer --&gt; GUI Form，选择一个布局管理器，我用的是 GridBagLayout，命名为 GUI。</li>
<li>在 GUI.form 中添加几个部件，回到 GUI.java，右键 Class 空白处，Generate --&gt; Form main()，然后运行即可。</li>
</ol>
<p>这里可能会报错，可以在 Settings 里搜索 Gradle，把 Build and run 改为 IDEA，把 Gradle JVM 改为项目相同。</p>
<h4 id="2-设计-gui">2. 设计 GUI</h4>
<p>IDEA 自动添加代码：Settings 里搜索 GUI Designer，改为 Java source code。</p>
<h4 id="3-设计事件">3. 设计事件</h4>
<p>代码过长，此处省略，可以直接去看 <a href="https://github.com/Lifeni/java-restful-api-server">项目代码</a> 中的 <code>gui</code> 部分。</p>
</article>
</body>
</html>