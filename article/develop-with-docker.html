<!DOCTYPE html>
<html lang="zh-hans">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Docker æ­å»ºå¼€å‘ç¯å¢ƒ</title>
<link rel="stylesheet" href="../static/css/markdown.css">
</head>
<body>
<article class="markdown-body">
<h1 id="docker-æ­å»ºå¼€å‘ç¯å¢ƒ">Docker æ­å»ºå¼€å‘ç¯å¢ƒ</h1>
<p>ğŸ“Œ åœ¨ Docker ä¸­å®‰è£…éƒ¨ç½² Nginx / Node.js ç­‰</p>
<p>ğŸ’¿ ä»¥ä¸‹å‡ä»¥ CentOS 7.6 64ä½ ä¸ºä¾‹ï¼Œå‘½ä»¤å‡ä»¥ root æ‰§è¡Œ</p>
<h2 id="å®‰è£…-docker">å®‰è£… Docker</h2>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.docker.com/install/linux/docker-ce/centos/#install-using-the-repository">Get Docker Engine - Community for CentOS | Docker Documentation</a></p>
<p>å®˜æ–¹æä¾›äº†ä¸‰ç§å®‰è£…æ–¹æ³•ï¼Œè¿™é‡Œé‡‡ç”¨ç¬¬ä¸€ç§ï¼šä½¿ç”¨ Repository å®‰è£…ã€‚</p>
<ol>
<li><p>å®‰è£…å¿…è¦çš„åŒ…ã€‚</p>
<pre><code class="language-bash"><span class="hljs-attr">yum</span> <span class="hljs-string">install -y yum-utils \
device-mapper-persistent-data \
lvm2</span></code></pre>
</li>
<li><p>è®¾å®š Repositoryã€‚</p>
<pre><code class="language-bash">yum-config-manager \
--<span class="hljs-built_in">add</span>-repo \
http<span class="hljs-variable">s:</span>//download.docker.<span class="hljs-keyword">com</span>/linux/centos/docker-<span class="hljs-keyword">ce</span>.repo</code></pre>
</li>
<li><p>å®‰è£… Docker Engine - Communityã€‚</p>
<pre><code class="language-bash">yum install docker-<span class="hljs-keyword">ce</span> docker-<span class="hljs-keyword">ce</span>-cli containerd.io</code></pre>
</li>
<li><p>å¯åŠ¨ Dockerã€‚</p>
<pre><code class="language-bash">systemctl <span class="hljs-literal">start</span> docker</code></pre>
</li>
<li><p>ä½¿ç”¨ hello-world é•œåƒæµ‹è¯•ã€‚</p>
<pre><code class="language-bash">docker <span class="hljs-keyword">run</span><span class="bash"> hello-world</span></code></pre>
</li>
</ol>
<h2 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h2>
<p>ä½¿ç”¨ <code>docker --help</code> æŸ¥çœ‹å¸®åŠ©ã€‚</p>
<h3 id="é…ç½®å›½å†…é•œåƒ">é…ç½®å›½å†…é•œåƒ</h3>
<p>å¯ä»¥ä½¿ç”¨ä¸‹é¢ç»™å‡ºçš„è¿™ä¸ªï¼Œä¹Ÿå¯ä»¥ç”¨ é˜¿é‡Œäº‘ æä¾›çš„åŠ é€ŸæœåŠ¡ï¼Œé…ç½®å¯ä»¥å‚è€ƒï¼š<a href="https://help.aliyun.com/document_detail/60750.html">å®˜æ–¹é•œåƒåŠ é€Ÿ_å¿«é€Ÿå…¥é—¨_å®¹å™¨é•œåƒæœåŠ¡-é˜¿é‡Œäº‘</a>ï¼Œç›®å‰è¿™ä¸ªæœåŠ¡æ˜¯å…è´¹çš„ã€‚</p>
<pre><code class="language-bash">vim <span class="hljs-meta-keyword">/etc/</span>docker/daemmon.json

<span class="hljs-meta"># æ·»åŠ ä¸‹é¢è¿™å¥ï¼š</span>
<span class="hljs-meta"># {<span class="hljs-string">"registry-mirrors"</span>:[<span class="hljs-string">"https://registry.docker-cn.com"</span>]}</span>

systemctl daemon-reload
systemctl restart docker</code></pre>
<h3 id="æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯">æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</h3>
<pre><code class="language-bash">docker <span class="hljs-keyword">version</span>        <span class="hljs-comment"># æŸ¥çœ‹è¯¦ç»†ç‰ˆæœ¬ä¿¡æ¯</span>
docker --<span class="hljs-keyword">version</span>     <span class="hljs-comment"># æŸ¥çœ‹ç®€å•ç‰ˆæœ¬ä¿¡æ¯</span>
docker -v             <span class="hljs-comment"># åŒä¸Š</span>
docker <span class="hljs-literal">inf</span>o            <span class="hljs-comment"># æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯</span></code></pre>
<h3 id="é•œåƒ">é•œåƒ</h3>
<p>é•œåƒå’Œè™šæ‹Ÿæœºä¸­çš„é•œåƒç±»ä¼¼ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºå®¹å™¨ã€‚</p>
<pre><code class="language-bash"><span class="hljs-comment"># æœç´¢é•œåƒ</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">search nginx</span>
<span class="hljs-comment"># è·å–é•œåƒï¼Œé»˜è®¤ä¸º latest</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">pull nginx</span>
<span class="hljs-comment"># æŸ¥çœ‹å·²å®‰è£…é•œåƒ</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">images</span>
<span class="hljs-comment"># ç§»é™¤é•œåƒï¼Œéœ€è¦å…ˆç§»é™¤ä½¿ç”¨é•œåƒçš„å®¹å™¨</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">rmi hello-world</span>
<span class="hljs-comment"># è®¾ç½®æ ‡ç­¾ test</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">tag 231d40e811cd author/nginx:test</span></code></pre>
<p>å¯ä»¥æ ¹æ®å®¹å™¨æ¥åˆ›å»ºä¸€ä¸ªé•œåƒï¼Œè¿™é‡Œä½¿ç”¨å‘½ä»¤åˆ›å»ºï¼Œå¦å¤–å¯ä»¥ä½¿ç”¨ Dockerfile æ–‡ä»¶åˆ›å»ºã€‚</p>
<pre><code class="language-bash"><span class="hljs-comment"># æè¿°ä¿¡æ¯ ä½œè€… å®¹å™¨ID ç›®æ ‡é•œåƒå:TAG</span>
docker commit -m=<span class="hljs-string">"description"</span> -<span class="hljs-keyword">a</span>=<span class="hljs-string">"author"</span> <span class="hljs-number">231</span>d40e811cd author/nginx:<span class="hljs-built_in">new</span></code></pre>
<p>ä¹‹åè¿è¡Œ <code>docker images</code> å¯ä»¥çœ‹åˆ°æ–°çš„é•œåƒã€‚</p>
<h3 id="å®¹å™¨">å®¹å™¨</h3>
<p>å®¹å™¨æ˜¯é•œåƒçš„å®ä¾‹ã€‚</p>
<pre><code class="language-bash"><span class="hljs-comment"># å¯åŠ¨å®¹å™¨ -i äº¤äº’å¼æ“ä½œ -t ç»ˆç«¯ é•œåƒå å‘½ä»¤</span>
docker run -it ubuntu <span class="hljs-regexp">/bin/</span>bash
<span class="hljs-comment"># é€€å‡ºç»ˆç«¯</span>
<span class="hljs-keyword">exit</span>
<span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</span>
docker ps -a
<span class="hljs-comment"># åœæ­¢å®¹å™¨ å®¹å™¨ID</span>
docker stop <span class="hljs-number">231</span>d40e811cd
<span class="hljs-comment"># å¯åŠ¨åœæ­¢çš„å®¹å™¨ å®¹å™¨ID</span>
docker start <span class="hljs-number">231</span>d40e811cd
<span class="hljs-comment"># é‡å¯å®¹å™¨ å®¹å™¨ID</span>
docker restart <span class="hljs-number">231</span>d40e811cd
<span class="hljs-comment"># åˆ é™¤å®¹å™¨ å®¹å™¨ID -f åˆ é™¤åŒ…æ‹¬è¿è¡Œä¸­çš„å®¹å™¨</span>
docker rm <span class="hljs-number">79</span>f8c2bcaed3
<span class="hljs-comment"># å¤åˆ¶æ–‡ä»¶åˆ°ä¸»æœº</span>
docker cp ab520f782c4b:<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/nginx.conf /</span>home<span class="hljs-regexp">/nginx</span></code></pre>
<p>åœ¨å¯åŠ¨å®¹å™¨æ—¶æ·»åŠ  <code>-d</code> å‚æ•°å¯ä»¥åœ¨åå°è¿è¡Œï¼Œæ­¤æ—¶å¯ä»¥ç”¨ <code>exec</code> å‘½ä»¤é‡æ–°è¿›å…¥ã€‚</p>
<pre><code class="language-bash">docker exec -it 231d40e811<span class="hljs-keyword">cd</span> <span class="hljs-string">/bin/bash</span></code></pre>
<p>åœ¨ Web åº”ç”¨ä¸­è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ã€‚</p>
<pre><code class="language-bash"><span class="hljs-comment"># -p è®¾ç½®ç«¯å£ </span>
docker <span class="hljs-builtin-name">run</span> -d -p 5000:5000 webapp
<span class="hljs-comment"># æŸ¥çœ‹ç«¯å£ å®¹å™¨ID</span>
docker<span class="hljs-built_in"> port </span>231d40e811cd
<span class="hljs-comment"># æŸ¥çœ‹æ—¥å¿— å®¹å™¨ID</span>
docker logs -f 231d40e811cd
<span class="hljs-comment"># æŸ¥çœ‹è¿›ç¨‹ å®¹å™¨ID</span>
docker top 231d40e811cd;
<span class="hljs-comment"># æŸ¥çœ‹é…ç½®ä¿¡æ¯ å®¹å™¨ID</span>
docker inspect ab520f782c4b;</code></pre>
<h2 id="dockerfile">Dockerfile</h2>
<p>âœ’ å¾…è¡¥å……ã€‚</p>
<p>æ¡ˆä¾‹è§ Nodejs éƒ¨ç½²éƒ¨åˆ†ã€‚</p>
<h2 id="éƒ¨ç½²nginx">éƒ¨ç½²Nginx</h2>
<h3 id="å®‰è£…">å®‰è£…</h3>
<pre><code class="language-bash"><span class="hljs-comment"># å®‰è£…æœ€æ–°ç‰ˆ</span>
docker pull nginx:latest

<span class="hljs-comment"># å¯åŠ¨ Nginx</span>
docker run -d <span class="hljs-string">\</span>      <span class="hljs-comment"># åå°è¿è¡Œ</span>
-p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> <span class="hljs-string">\</span>            <span class="hljs-comment"># ç«¯å£æ˜ å°„ ä¸»æœº:å®¹å™¨</span>
--name nginx-test <span class="hljs-string">\</span>  <span class="hljs-comment"># å‘½å</span>
nginx</code></pre>
<p>ä¹‹åè®¿é—®ä¸»æœº IP å³å¯çœ‹åˆ° Nginx çš„æ¬¢è¿é¡µé¢ã€‚</p>
<h3 id="é…ç½®">é…ç½®</h3>
<p>åœ¨ä¸»æœºä¸Šåˆ›å»ºå¥½ç›®å½•å’Œæ–‡ä»¶ï¼Œé‡å®šå‘åˆ°å®¹å™¨ä¸­å³å¯ï¼Œæˆ‘è¿™é‡ŒåŒæ—¶é…ç½®äº† SSLï¼Œæ‰€ä»¥ä¼šæœ‰ä¸¤ä¸ªç«¯å£ã€‚</p>
<ul>
<li><p><code>:ro</code> è¡¨ç¤ºåªè¯»æ¨¡å¼ã€‚</p>
</li>
<li><p><code>--net=host</code> è¡¨ç¤ºå®¹å™¨å¯ä»¥ç›´æ¥è®¿é—®ä¸»æœºä¸Šæ‰€æœ‰çš„ç½‘ç»œä¿¡æ¯ã€‚</p>
</li>
</ul>
<pre><code class="language-bash">docker run \
--name nginx \
-d -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> -p <span class="hljs-number">443</span>:<span class="hljs-number">443</span> \
--net=host \
-v <span class="hljs-regexp">/home/</span><span class="hljs-string">www:</span><span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/nginx/</span>html \
-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/nginx.conf:/</span>etc<span class="hljs-regexp">/nginx/</span>nginx.<span class="hljs-string">conf:</span>ro \
-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/conf.d:/</span>etc<span class="hljs-regexp">/nginx/</span>conf.<span class="hljs-string">d:</span>ro \
-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/cert:/</span>etc<span class="hljs-regexp">/nginx/</span><span class="hljs-string">cert:</span>ro \
-v <span class="hljs-regexp">/home/</span>nginx<span class="hljs-regexp">/log:/</span>var<span class="hljs-regexp">/log/</span>nginx \
nginx</code></pre>
<p>ä¹‹åå¯ä»¥å°†é•œåƒå¯¼å‡ºï¼Œä»¥ä¾¿ä»¥åä½¿ç”¨ï¼ˆè¿™é‡Œå¯¼å‡ºå…¶å®æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºæ²¡æœ‰æ”¹åŠ¨ï¼Œé‡å®šå‘ä¸ä¼šè¢«è®°å½•åˆ°é•œåƒä¸­ï¼‰ã€‚</p>
<pre><code class="language-bash">docker commit <span class="hljs-string">\</span>
--author <span class="hljs-string">"Lifeni"</span> <span class="hljs-string">\</span>
--message <span class="hljs-string">"New Nginx"</span> <span class="hljs-string">\</span>
nginx <span class="hljs-string">\</span>
nginx:v1</code></pre>
<h2 id="éƒ¨ç½²-nodejs">éƒ¨ç½² Node.js</h2>
<p>å…ˆè·å– Nodejs é•œåƒï¼Œå†ä½¿ç”¨ Dockerfile é…ç½®ã€‚</p>
<pre><code class="language-bash">docker pull <span class="hljs-keyword">node</span><span class="hljs-title"></span></code></pre>
<p>åœ¨ Nodejs é¡¹ç›®ä¸‹æ–°å»º Dockerfile: </p>
<pre><code class="language-dockerfile"><span class="hljs-keyword">FROM</span> node:latest
<span class="hljs-keyword">RUN</span><span class="bash"> mkdir -p /home/app</span>
<span class="hljs-keyword">WORKDIR</span><span class="bash"> /home/app</span>
<span class="hljs-keyword">COPY</span><span class="bash"> . /home/app</span>
<span class="hljs-keyword">RUN</span><span class="bash"> npm install -d --registry=https://registry.npm.taobao.org</span>
<span class="hljs-keyword">RUN</span><span class="bash"> npm install</span>
<span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">2333</span>
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">"npm"</span>, <span class="hljs-string">"start"</span>]</span></code></pre>
<p>ä¹‹ååœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ„å»ºé•œåƒã€‚</p>
<pre><code class="language-bash">docker build -t <span class="hljs-keyword">node</span><span class="hljs-title">-blog</span> /home/<span class="hljs-keyword">node</span><span class="hljs-title"></span></code></pre>
<p>å¯åŠ¨å®¹å™¨ã€‚</p>
<pre><code class="language-bash">docker run -d \
-p <span class="hljs-number">2333</span>:<span class="hljs-number">2333</span> \
<span class="hljs-keyword">node</span><span class="hljs-title">-blog</span></code></pre>
<h2 id="éƒ¨ç½²-tomcat">éƒ¨ç½² Tomcat</h2>
<p>åªæ˜¯ç®€å•çš„éƒ¨ç½²ï¼š</p>
<pre><code class="language-bash"><span class="hljs-comment"># å®‰è£…</span>
<span class="hljs-attr">docker</span> <span class="hljs-string">pull tomcat</span>
<span class="hljs-comment">
# è¿è¡Œ</span>
 <span class="hljs-attr">docker</span> <span class="hljs-string">run -d \
 -v /root/java/server.war:/usr/local/tomcat/webapps/server.war \
 -p 8080:8080 \
 tomcat</span>
<span class="hljs-comment">
 # è¿›å…¥ Container</span>
 <span class="hljs-attr">docker</span> <span class="hljs-string">exec -it 59b9517b8a1e /bin/bash</span></code></pre>
</article>
</body>
</html>